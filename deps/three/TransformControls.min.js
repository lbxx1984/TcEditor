!function(){"use strict";var b,c,a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype),a.prototype.constructor=a,b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}},b.prototype=Object.create(THREE.LineBasicMaterial.prototype),b.prototype.constructor=b,c=new a({visible:!1,transparent:!1}),THREE.TransformGizmo=function(){this.init=function(){var a,b,c,d,e;THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)},this.activePlane=c["XYZE"],c["YZ"].rotation.set(0,Math.PI/2,0),c["XZ"].rotation.set(-Math.PI/2,0,0);for(d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d];e=function(a,b){var c,e,f,g;for(c in a)for(d=a[c].length;d--;)e=a[c][d][0],f=a[c][d][1],g=a[c][d][2],e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),b.add(e)},e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name===a?b.material.highlight(!0):b.material.highlight(!1))})}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo,THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){-1!==f.name.search("E")?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):(-1!==f.name.search("X")||-1!==f.name.search("Y")||-1!==f.name.search("Z"))&&f.quaternion.setFromEuler(a)})},THREE.TransformGizmoTranslate=function(){var d,e,f,g,h;THREE.TransformGizmo.call(this),d=new THREE.Geometry,e=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1)),e.position.y=.5,e.updateMatrix(),d.merge(e.geometry,e.matrix),f=new THREE.BufferGeometry,f.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3)),g=new THREE.BufferGeometry,g.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3)),h=new THREE.BufferGeometry,h.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),c)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes["XY"].matrixWorld))),"X"===a&&(this.activePlane=this.planes["XY"],Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes["XZ"])),"Y"===a&&(this.activePlane=this.planes["XY"],Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes["YZ"])),"Z"===a&&(this.activePlane=this.planes["XZ"],Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes["YZ"])),"XYZ"===a&&(this.activePlane=this.planes["XYZE"]),"XY"===a&&(this.activePlane=this.planes["XY"]),"YZ"===a&&(this.activePlane=this.planes["YZ"]),"XZ"===a&&(this.activePlane=this.planes["XZ"])},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate,THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var a=function(a,b,c){var f,d=new THREE.BufferGeometry,e=[];for(c=c?c:1,f=0;64*c>=f;++f)"x"===b&&e.push(0,Math.cos(f/32*Math.PI)*a,Math.sin(f/32*Math.PI)*a),"y"===b&&e.push(Math.cos(f/32*Math.PI)*a,0,Math.sin(f/32*Math.PI)*a),"z"===b&&e.push(Math.sin(f/32*Math.PI)*a,Math.cos(f/32*Math.PI)*a,0);return d.addAttribute("position",new THREE.Float32Attribute(e,3)),d};this.handleGizmos={X:[[new THREE.Line(new a(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new a(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new a(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new a(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new a(1,"z",1),new b({color:7895160}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),c)]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]},this.setActivePlane=function(a){"E"===a&&(this.activePlane=this.planes["XYZE"]),"X"===a&&(this.activePlane=this.planes["YZ"]),"Y"===a&&(this.activePlane=this.planes["XZ"]),"Z"===a&&(this.activePlane=this.planes["XY"])},this.update=function(a,b){var d,e,f,g,h,i,j,k,l,m;THREE.TransformGizmo.prototype.update.apply(this,arguments),{handles:this["handles"],pickers:this["pickers"]},d=new THREE.Matrix4,e=new THREE.Euler(0,0,1),f=new THREE.Quaternion,g=new THREE.Vector3(1,0,0),h=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,0,1),j=new THREE.Quaternion,k=new THREE.Quaternion,l=new THREE.Quaternion,m=b.clone(),e.copy(this.planes["XY"].rotation),f.setFromEuler(e),d.makeRotationFromQuaternion(f).getInverse(d),m.applyMatrix4(d),this.traverse(function(a){f.setFromEuler(e),"X"===a.name&&(j.setFromAxisAngle(g,Math.atan2(-m.y,m.z)),f.multiplyQuaternions(f,j),a.quaternion.copy(f)),"Y"===a.name&&(k.setFromAxisAngle(h,Math.atan2(m.x,m.z)),f.multiplyQuaternions(f,k),a.quaternion.copy(f)),"Z"===a.name&&(l.setFromAxisAngle(i,Math.atan2(m.y,m.x)),f.multiplyQuaternions(f,l),a.quaternion.copy(f))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate,THREE.TransformGizmoScale=function(){var d,e,f,g,h;THREE.TransformGizmo.call(this),d=new THREE.Geometry,e=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125)),e.position.y=.5,e.updateMatrix(),d.merge(e.geometry,e.matrix),f=new THREE.BufferGeometry,f.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3)),g=new THREE.BufferGeometry,g.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3)),h=new THREE.BufferGeometry,h.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),c)]]},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes["XY"].matrixWorld))),"X"===a&&(this.activePlane=this.planes["XY"],Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes["XZ"])),"Y"===a&&(this.activePlane=this.planes["XY"],Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes["YZ"])),"Z"===a&&(this.activePlane=this.planes["XZ"],Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes["YZ"])),"XYZ"===a&&(this.activePlane=this.planes["XYZE"])},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale,THREE.TransformControls=function(a,b){function R(a){var b,f,h;void 0===c.object||e===!0||void 0!==a.button&&0!==a.button||(b=a.changedTouches?a.changedTouches[0]:a,f=V(b,g[d].pickers.children),h=null,f&&(h=f.object.name,a.preventDefault()),c.axis!==h&&(c.axis=h,c.update(),c.dispatchEvent(j)))}function S(a){var b,f,h;void 0===c.object||e===!0||void 0!==a.button&&0!==a.button||(b=a.changedTouches?a.changedTouches[0]:a,(0===b.button||void 0===b.button)&&(f=V(b,g[d].pickers.children),f&&(a.preventDefault(),a.stopPropagation(),c.dispatchEvent(k),c.axis=f.object.name,c.update(),v.copy(P).sub(M).normalize(),g[d].setActivePlane(c.axis,v),h=V(b,[g[d].activePlane]),h&&(H.copy(c.object.position),I.copy(c.object.scale),J.extractRotation(c.object.matrix),O.extractRotation(c.object.matrixWorld),K.extractRotation(c.object.parent.matrixWorld),L.setFromMatrixScale(w.getInverse(c.object.parent.matrixWorld)),q.copy(h.point)))),e=!0)}function T(a){var b,f;void 0===c.object||null===c.axis||e===!1||void 0!==a.button&&0!==a.button||(b=a.changedTouches?a.changedTouches[0]:a,f=V(b,[g[d].activePlane]),f!==!1&&(a.preventDefault(),a.stopPropagation(),p.copy(f.point),"translate"===d?(p.sub(q),p.multiply(L),"local"===c.space&&(p.applyMatrix4(w.getInverse(O)),-1===c.axis.search("X")&&(p.x=0),-1===c.axis.search("Y")&&(p.y=0),-1===c.axis.search("Z")&&(p.z=0),p.applyMatrix4(J),c.object.position.copy(H),c.object.position.add(p)),("world"===c.space||-1!==c.axis.search("XYZ"))&&(-1===c.axis.search("X")&&(p.x=0),-1===c.axis.search("Y")&&(p.y=0),-1===c.axis.search("Z")&&(p.z=0),p.applyMatrix4(w.getInverse(K)),c.object.position.copy(H),c.object.position.add(p)),null!==c.snap&&(-1!==c.axis.search("X")&&(c.object.position.x=Math.round(c.object.position.x/c.snap)*c.snap),-1!==c.axis.search("Y")&&(c.object.position.y=Math.round(c.object.position.y/c.snap)*c.snap),-1!==c.axis.search("Z")&&(c.object.position.z=Math.round(c.object.position.z/c.snap)*c.snap))):"scale"===d?(p.sub(q),p.multiply(L),"local"===c.space&&("XYZ"===c.axis?(t=1+p.y/50,c.object.scale.x=I.x*t,c.object.scale.y=I.y*t,c.object.scale.z=I.z*t):(p.applyMatrix4(w.getInverse(O)),"X"===c.axis&&(c.object.scale.x=I.x*(1+p.x/50)),"Y"===c.axis&&(c.object.scale.y=I.y*(1+p.y/50)),"Z"===c.axis&&(c.object.scale.z=I.z*(1+p.z/50))))):"rotate"===d&&(p.sub(M),p.multiply(L),x.copy(q).sub(M),x.multiply(L),"E"===c.axis?(p.applyMatrix4(w.getInverse(u)),x.applyMatrix4(w.getInverse(u)),r.set(Math.atan2(p.z,p.y),Math.atan2(p.x,p.z),Math.atan2(p.y,p.x)),s.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),y.setFromRotationMatrix(w.getInverse(K)),G.setFromAxisAngle(v,r.z-s.z),C.setFromRotationMatrix(O),y.multiplyQuaternions(y,G),y.multiplyQuaternions(y,C),c.object.quaternion.copy(y)):"XYZE"===c.axis?(G.setFromEuler(p.clone().cross(x).normalize()),y.setFromRotationMatrix(w.getInverse(K)),D.setFromAxisAngle(G,-p.clone().angleTo(x)),C.setFromRotationMatrix(O),y.multiplyQuaternions(y,D),y.multiplyQuaternions(y,C),c.object.quaternion.copy(y)):"local"===c.space?(p.applyMatrix4(w.getInverse(O)),x.applyMatrix4(w.getInverse(O)),r.set(Math.atan2(p.z,p.y),Math.atan2(p.x,p.z),Math.atan2(p.y,p.x)),s.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),C.setFromRotationMatrix(J),D.setFromAxisAngle(z,r.x-s.x),E.setFromAxisAngle(A,r.y-s.y),F.setFromAxisAngle(B,r.z-s.z),"X"===c.axis&&C.multiplyQuaternions(C,D),"Y"===c.axis&&C.multiplyQuaternions(C,E),"Z"===c.axis&&C.multiplyQuaternions(C,F),c.object.quaternion.copy(C)):"world"===c.space&&(r.set(Math.atan2(p.z,p.y),Math.atan2(p.x,p.z),Math.atan2(p.y,p.x)),s.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),y.setFromRotationMatrix(w.getInverse(K)),D.setFromAxisAngle(z,r.x-s.x),E.setFromAxisAngle(A,r.y-s.y),F.setFromAxisAngle(B,r.z-s.z),C.setFromRotationMatrix(O),"X"===c.axis&&y.multiplyQuaternions(y,D),"Y"===c.axis&&y.multiplyQuaternions(y,E),"Z"===c.axis&&y.multiplyQuaternions(y,F),y.multiplyQuaternions(y,C),c.object.quaternion.copy(y))),c.update(),c.dispatchEvent(j),c.dispatchEvent(m)))}function U(a){(void 0===a.button||0===a.button)&&(e&&null!==c.axis&&(l.mode=d,c.dispatchEvent(l)),e=!1,R(a))}function V(c,d){var h,e=b.getBoundingClientRect(),f=(c.clientX-e.left)/e.width,g=(c.clientY-e.top)/e.height;return o.set(2*f-1,-(2*g)+1),n.setFromCamera(o,a),h=n.intersectObjects(d,!0),h[0]?h[0]:!1}var c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;THREE.Object3D.call(this),b=void 0!==b?b:document,this.object=void 0,this.visible=!1,this.snap=null,this.space="world",this.size=1,this.axis=null,c=this,d="translate",e=!1,g={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale};for(h in g)i=g[h],i.visible=h===d,this.add(i);j={type:"change"},k={type:"mouseDown"},l={type:"mouseUp",mode:d},m={type:"objectChange"},n=new THREE.Raycaster,o=new THREE.Vector2,p=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,t=1,u=new THREE.Matrix4,v=new THREE.Vector3,w=new THREE.Matrix4,x=new THREE.Vector3,y=new THREE.Quaternion,z=new THREE.Vector3(1,0,0),A=new THREE.Vector3(0,1,0),B=new THREE.Vector3(0,0,1),C=new THREE.Quaternion,D=new THREE.Quaternion,E=new THREE.Quaternion,F=new THREE.Quaternion,G=new THREE.Quaternion,H=new THREE.Vector3,I=new THREE.Vector3,J=new THREE.Matrix4,K=new THREE.Matrix4,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Euler,O=new THREE.Matrix4,P=new THREE.Vector3,Q=new THREE.Euler,b.addEventListener("mousedown",S,!1),b.addEventListener("touchstart",S,!1),b.addEventListener("mousemove",R,!1),b.addEventListener("touchmove",R,!1),b.addEventListener("mousemove",T,!1),b.addEventListener("touchmove",T,!1),b.addEventListener("mouseup",U,!1),b.addEventListener("mouseout",U,!1),b.addEventListener("touchend",U,!1),b.addEventListener("touchcancel",U,!1),b.addEventListener("touchleave",U,!1),this.dispose=function(){b.removeEventListener("mousedown",S),b.removeEventListener("touchstart",S),b.removeEventListener("mousemove",R),b.removeEventListener("touchmove",R),b.removeEventListener("mousemove",T),b.removeEventListener("touchmove",T),b.removeEventListener("mouseup",U),b.removeEventListener("mouseout",U),b.removeEventListener("touchend",U),b.removeEventListener("touchcancel",U),b.removeEventListener("touchleave",U)},this.attach=function(a){this.object=a,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.setMode=function(a){d=a?a:d,"scale"===d&&(c.space="local");for(var b in g)g[b].visible=b===d;this.update(),c.dispatchEvent(j)},this.setSnap=function(a){c.snap=a},this.setSize=function(a){c.size=a,this.update(),c.dispatchEvent(j)},this.setSpace=function(a){c.space=a,this.update(),c.dispatchEvent(j)},this.update=function(){void 0!==c.object&&(c.object.updateMatrixWorld(),M.setFromMatrixPosition(c.object.matrixWorld),N.setFromRotationMatrix(w.extractRotation(c.object.matrixWorld)),a.updateMatrixWorld(),P.setFromMatrixPosition(a.matrixWorld),Q.setFromRotationMatrix(w.extractRotation(a.matrixWorld)),t=M.distanceTo(P)/6*c.size,this.position.copy(M),this.scale.set(t,t,t),v.copy(P).sub(M).normalize(),"local"===c.space?g[d].update(N,v):"world"===c.space&&g[d].update(new THREE.Euler,v),g[d].highlight(c.axis))}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformControls.prototype.constructor=THREE.TransformControls}();